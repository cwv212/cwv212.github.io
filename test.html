<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>m3u8 플레이어</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Roboto', sans-serif;
            display: flex;
            height: 100vh;
            background: #f4f7fa;
            color: #333;
            overflow: hidden;
        }
        #sidebar {
            width: 220px;
            padding: 15px;
            background: #fff;
            height: 100%;
            overflow-y: auto;
            transition: transform 0.3s ease;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 10;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        #sidebar.collapsed {
            transform: translateX(-100%);
        }
        #player-container {
            flex-grow: 1;
            margin-left: 220px;
            height: 100vh;
            display: grid;
            gap: 2px;
            transition: margin-left 0.3s ease;
        }
        #sidebar.collapsed + #player-container {
            margin-left: 0;
        }
        .player-box {
            background: #f0f2f5;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        #toggle-btn {
            position: fixed;
            top: 10px;
            left: 200px;
            width: 20px;
            height: 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            z-index: 11;
            transition: left 0.3s ease;
        }
        #sidebar.collapsed + #player-container #toggle-btn {
            left: 10px;
        }
        #toggle-btn:hover {
            background: #0056b3;
        }
        h3, h4 {
            font-size: 14px;
            margin: 10px 0 5px;
            color: #495057;
        }
        .channel-section {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
            max-height: 50px; /* 기본 닫힌 상태 */
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .channel-section.expanded {
            max-height: 200px; /* 열린 상태 */
            overflow-y: auto;
        }
        .small-channel-btn {
            padding: 6px 10px;
            background: #e9ecef;
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
            cursor: pointer;
            min-width: 33px;
        }
        .small-channel-btn:hover {
            background: #dee2e6;
        }
        .toggle-section-btn {
            margin-left: 10px;
            padding: 4px 8px;
            font-size: 12px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .toggle-section-btn:hover {
            background: #218838;
        }
        button {
            padding: 8px 15px;
            margin: 5px 5px 5px 0;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 90px;
        }
        button:hover {
            background: #0056b3;
        }
        #split-screen-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h3>숙제 채널</h3>
        <div id="lck-channels" class="channel-section"></div>
        <h4>스트리머 채널</h4>
        <div id="chzzk-channels" class="channel-section"></div>
        <h4>스포티비 채널<button id="spotv-toggle-btn" class="toggle-section-btn">열기</button></h4>
        <div id="spotv-channels" class="channel-section collapsed"></div>
        <h4>야구 채널</h4>
        <div id="baseball-channels" class="channel-section"></div>
        <h4>TV 채널</h4>
        <div id="tv-channels" class="channel-section"></div>
        <h3>분할 화면 설정</h3>
        <div id="split-screen-buttons">
            <button onclick="setSplitScreen(1)">1분할</button>
            <button onclick="setSplitScreen(2)">2분할</button>
            <button onclick="setSplitScreen(3)">3분할</button>
            <button onclick="setSplitScreen(4)">4분할</button>
        </div>
    </div>
    <div id="player-container">
        <button id="toggle-btn" onclick="toggleSidebar()">☰</button>
    </div>

    <script>
        const spotvChannels = Array.from({ length: 40 }, (_, i) => {
            const channelNum = String(i + 1).padStart(2, '0');
            return { name: `${i + 1}`, url: `https://ch${channelNum}-nlivecdn.spotvnow.co.kr/ch${channelNum}/decr/medialist_14173921312004482655_hls.m3u8` };
        });
        const chzzkChannels = [
            { name: '풍', id: '7ce8032370ac5121dcabce7bad375ced' },
            { name: '침', id: 'bb382c2c0cc9fa7c86ab3b037fb5799c' },
        ];
        const baseballChannels = Array.from({ length: 5 }, (_, i) => ({
            name: `야${i + 1}`, url: `https://global-media.sooplive.com/live/soopbaseball${i + 1}/master.m3u8`
        }));
        const tvChannels = [
            { name: 'K1', url: 'https://stream.ogtv3.com/live/live1004.m3u8' },
            { name: 'K2', url: 'https://stream.ogtv3.com/live/live1005.m3u8' },
        ];
        const lckChannels = [
            { name: 'L', url: 'https://global-media.sooplive.com/live/lckkr/master.m3u8', type: 'm3u8' },
            { name: 'C', url: 'https://chzzk-api-proxy.hibiya.workers.dev/m3u8-redirect/9381e7d6816e6d915a44a13c0195b202', type: 'm3u8' },
        ];

        const chzzkProxyBaseUrl = 'https://chzzk-api-proxy.hibiya.workers.dev/m3u8-redirect/';
        const extensionId = 'eakdijdofmnclopcffkkgmndadhbjgka';

        const spotvChannelList = document.getElementById('spotv-channels');
        const chzzkChannelList = document.getElementById('chzzk-channels');
        const baseballChannelList = document.getElementById('baseball-channels');
        const tvChannelList = document.getElementById('tv-channels');
        const lckChannelList = document.getElementById('lck-channels');
        const playerContainer = document.getElementById('player-container');
        const sidebar = document.getElementById('sidebar');
        let playerCount = 1;
        let clickIndex = 0;

        function createChannelButton(channel, container, type = 'm3u8') {
            const btn = document.createElement('div');
            btn.className = 'small-channel-btn';
            btn.textContent = channel.name;
            btn.dataset.url = channel.url || `${chzzkProxyBaseUrl}${channel.id}`;
            btn.dataset.type = type;
            btn.addEventListener('click', () => {
                const playerBoxes = playerContainer.querySelectorAll('.player-box');
                if (playerBoxes.length > 0) {
                    const targetBox = playerBoxes[clickIndex % playerBoxes.length];
                    loadPlayer(targetBox, btn.dataset.url, btn.dataset.type);
                    clickIndex++;
                }
            });
            container.appendChild(btn);
        }

        function initializeChannels() {
            console.log('Initializing channels...');
            spotvChannels.forEach(channel => createChannelButton(channel, spotvChannelList));
            chzzkChannels.forEach(channel => createChannelButton(channel, chzzkChannelList));
            baseballChannels.forEach(channel => createChannelButton(channel, baseballChannelList));
            tvChannels.forEach(channel => createChannelButton(channel, tvChannelList));
            lckChannels.forEach(channel => createChannelButton(channel, lckChannelList, channel.type));
        }

        const spotvToggleBtn = document.getElementById('spotv-toggle-btn');
        spotvToggleBtn.addEventListener('click', () => {
            if (spotvChannelList.classList.contains('collapsed')) {
                spotvChannelList.classList.remove('collapsed');
                spotvChannelList.classList.add('expanded');
                spotvToggleBtn.textContent = '닫기';
            } else {
                spotvChannelList.classList.remove('expanded');
                spotvChannelList.classList.add('collapsed');
                spotvToggleBtn.textContent = '열기';
            }
        });

        function toggleSidebar() {
            sidebar.classList.toggle('collapsed');
        }

        function setSplitScreen(count) {
            playerCount = count;
            clickIndex = 0;
            playerContainer.innerHTML = '<button id="toggle-btn" onclick="toggleSidebar()">☰</button>';
            for (let i = 0; i < count; i++) {
                const box = document.createElement('div');
                box.className = 'player-box';
                playerContainer.appendChild(box);
            }
            playerContainer.style.gridTemplateColumns = `repeat(${Math.min(count, 2)}, 1fr)`;
            playerContainer.style.gridTemplateRows = `repeat(${Math.ceil(count / 2)}, 1fr)`;
        }

        function loadPlayer(box, url, type) {
            while (box.firstChild) box.removeChild(box.firstChild);
            const iframe = document.createElement('iframe');
            iframe.src = type === 'm3u8' ? `chrome-extension://${extensionId}/player.html#${url}` : url;
            box.appendChild(iframe);
            console.log(`Loading player with URL: ${iframe.src}`);
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded');
            initializeChannels();
            setSplitScreen(1);
        });
    </script>
</body>
</html>
